# Сбербанк как highload-система в финтехе

## 1. Тема и целевая аудитория

### Тема

**Сервис:** Сбербанк Онлайн
**Аналоги:** Тбанк, ВТБ, Альфа-банк, Райффайзенбанк

### Целевая аудитория

Каждый 100-ый взрослый человек на Земле использует Сбербанк Онлайн [[2]](#источники).

Соотношение мужской аудитории к женской - 45% на 55% [[2]](#источники).

Рост аудитории на 2019 г. [[2]](#источники):
* +61% - среди клиентов старше 45 лет;
* +41% - младше 20 лет;
* +29% - 20 до 45 лет.

За пределами России услугами Сбербанка пользовались около 675 тыс. клиентов. [[7]](#источники)

Страна | Число клиентов
-|-
Казахстан | >1 млн. [[8]](#источники)
Беларусь | 700 тыс. [[8]](#источники)
Украина | 120 тыс. [[8]](#источники)
Сербия | 150 тыс. [[7]](#источники)
Чехия | 125 тыс. [[7]](#источники)
Европейские страны | >700 тыс. [[8]](#источники)

Доля Сбербанка на рынке в России [[1]](#источники):
- Активы: 30.1%
- Депозиты физических лиц: 44.6%
- Кредиты физическим лицам: 41.4%
- Корпоративные кредиты: 32.8%
- Зарплатные клиенты: 56.6%
- Остатки на кредитных картах: 45.2%
- Ипотечные кредиты: 55.8%

Вклады чаще всего открывают 20 - 29-летние - 33% [[2]](#источники).

Кредиты больше всех оформляют 30 - 39-летние - 47% [[2]](#источники).

Женщины оформляют почти 60 % всех кредитов и вкладов [[2]](#источники).

### Функциональность системы

**Функции, характеризующие сервис:**

- Просмотр баланса и истории операций
- Денежные переводы :между своими счетами, другим клиентам Сбера, по номеру телефона
- Оплата услуг: ЖКХ, штрафы, налоги, мобильная связь
- Открытие вкладов и оформление кредитов
- Пуш-уведомления о транзакциях
- Антифрод, проверка безопасности

**Ключевой функционал сервиса** - проведение платежей и переводов

## 2. Расчет нагрузки

### Продуктовые метрики

Метрика | Значение
-|-
Активные клиенты, 2025 г. | >110 млн (+0,5 млн с начала года) [[6]](#источники)
Monthly Active Users (приложение + веб), 2025 | 84.3 млн [[6]](#источники), [[5]](#источники), [[3]](#источники)
Daily Active Users (приложение + веб), 2025 | 42.5 млн [[6]](#источники), [[5]](#источники)
Соотношение DAU/MAU, 2025 | >50% [[6]](#источники)
Новые сессии в минуту, 2023 г. | 110 тыс./мин. [[4]](#источники)
Активные сессии одновременно, 2023 г. | >550 тыс. [[4]](#источники)
Длительность активной сессии, 2023 г. | ~5 мин. [[4]](#источники)
Частота входов на одного клиента, 2019 | 25 раз в месяц [[2]](#источники)

### Технические метрики

#### Объем хранилища

В месяц человек пользуется сервисом 25 раз, а средняя продолжительность одной сессии - 5 минут.  
Совокупное время пребывания пользователя в приложении в месяц:  
`25 * 5 мин. = 125 мин`.

При условии совершения 1 транзакции в минуту в спокойном режиме, среднее количество транзакций на одного пользователя в месяц составляет:  
`125 транзакций`.

Средний размер одного электронного чека: `60 КБ` (максимум `100 КБ`).  
Тогда объём данных на одного пользователя в месяц:  
`125 транзакций * 60 КБ = 7500 КБ ≈ 7.32 МБ`.

Ежемесячная аудитория приложения - `84.3 млн` пользователей.  
Значит, ежемесячный объём данных для всей аудитории:  
`84.3 млн * 7.32 МБ ≈ 588.5 ТБ`.

Годовой объём:  
`12 месяцев * 588.5 ТБ ≈ 7.1 ПБ`.

ПАО Сбербанк функционирует с 1991 года, то есть на момент 2025 года - `34 года`.  
Совокупный объём данных за весь период (при условии стабильной ежемесячной аудитории и активности):  
`34 года * 7.1 ПБ ≈ 241.4 ПБ`.

#### RPS (Requests Per Second)

Суммарное кол. запросов в секунду (RPS) составляет >120 тыс./сек. [[4]](#источники).  

Предположим, что за 5-минутную сессию типичный пользователь совершает:
Действие | Раз за сессию | Раз в сутки *
-|-|-
Авторизация | 1/30 ≈ 0.033 [[9]](#источники) | 1,4 тыс
Получение баланса | 2-3 | 106.25 млн
Получение чека | 0.3–0.6 | 19.13 млн
История платежей | 2/7 ≈ 0.3 | 12.7 млн
Открытие вкладов | - | 1.5 тыс [[15]](#источники)
Открытие кредит | - | 50 тыс [[16]](#источники)
Открытие ипотек | - | 3.1 тыс [[17]](#источники)
Перевод по СБП | - | 50.5 млн [[13]](#источники)
Перевод по QR | - | 11 млн [[10]](#источники), [[11]](#источники)
Оплата по биометрии | - | 660 тыс [[10]](#источники), [[11]](#источники)
Оплата банковскими картами | - | 163 млн [[12]](#источники)
Перевод международный | - | 4.7 тысяч [[14]](#источники)

\* Рассчитано на основе DAU = 42.5 млн и 1 сессии на активного пользователя в день.

Тип запроса	| Средний RPS (Операций в сутки / 86 400)	| Пиковый RPS (тройной средний RPS)
-|-|-
Авторизация | 16 | 48
Получение баланса | 1230 | 3689
Получение чека | 221 | 664
История платежей | 147 | 441
Открытие вкладов | 0.02 | 0.06
Открытие кредит | 0.6 | 1.8
Открытие ипотек | 0.04 | 0.12
Перевод по СБП | 584 | 1752
Перевод по QR | 127 | 381
Оплата по биометрии | 8 | 24
Оплата банковскими картами | 1887 | 5661
Перевод международный | 0.05 | 0.15
ИТОГО | 4221 | 12662

#### Сетевой трафик

Запросов в секунду (RPS) составляет 221. 
Также средний размер одного чека — `60 КБ = 61440 байт`.

Тогда объём данных в секунду:  
`221 запросов/сек * 61440 байт = 13 578 240 байт/с ≈ 108.6 Мбит/с` — пиковое потребление.

Суммарный суточный объём данных:  
`13 578 240 байт/с * 86 400 сек = 1 173 159 936 000 байт ≈ 1 173 ГБ/сутки ≈ 1.17 ТБ/сутки`.

## 3. Глобальная балансировка нагрузки

### Функциональное разбиение по доменам

Домен | Функционал | Средний RPS | Пиковый RPS | Распределение нагрузки, %
-|-|-|-|-
``wallet`` | Получение баланса, чела и истории платежей | 1598 | 4794 | 37,9
``transaction`` | Открытие вкладов, кредитов, вкладов; оплата по СБП, QR, биометрии, банковскими картами, международные | 2607 | 7818 | 62,1
``api`` | Весь остальной функционал, в частности, авторизация |

\* Составлено на основе таблицы из раздела "Расчет нагрузки".

### Расположение ДЦ

Группировка  ДЦ по регионам ([приложение B](#приложение-b)). Рассматривались города-миллионники.

#### Центральный регион

| Город | Население | Доля от РФ | DAU (общий DAU * доля от РФ) |
|-------|-----------|------------|-----|
| Москва | ~13.1 млн | 9.0% | 3 825 000 |
| Нижний Новгород | ~1.2 млн | 0.8% | 340 000 |
| Воронеж | ~1.0 млн | 0.7% | 297 500 |
| Волгоград | ~1.0 млн | 0.7% | 297 500 |
| **Итого** | **~16.4 млн** | **11.2%** | **4 760 000** |

#### Северо-Западный регион

| Город | Население | Доля от РФ | DAU |
|-------|-----------|------------|-----|
| Санкт-Петербург | ~5.6 млн | 3.8% | 1 615 000 |
| **Итого** | **~5.6 млн** | **3.8%** | **1 615 000** |

#### Уральский регион

| Город | Население | Доля от РФ | DAU |
|-------|-----------|------------|-----|
| Екатеринбург | ~1.5 млн | 1.1% | 467 500 |
| Челябинск | ~1.2 млн | 0.8% | 340 000 |
| Уфа | ~1.2 млн | 0.8% | 340 000 |
| Пермь | ~1.0 млн | 0.7% | 297 500 |
| **Итого** | **~4.9 млн** | **3.4%** | **1 445 000** |

#### Сибирский регион

| Город | Население | Доля от РФ | DAU |
|-------|-----------|------------|-----|
| Новосибирск | ~1.6 млн | 1.1% | 467 500 |
| Красноярск | ~1.2 млн | 0.8% | 340 000 |
| Омск | ~1.1 млн | 0.8% | 340 000 |
| **Итого** | **~3.9 млн** | **2.7%** | **1 147 500** |

#### Приволжский регион

| Город | Население | Доля от РФ | DAU |
|-------|-----------|------------|-----|
| Казань | ~1.3 млн | 0.9% | 382 500 |
| Самара | ~1.2 млн | 0.8% | 340 000 |
| **Итого** | **~2.5 млн** | **1.7%** | **722 500** |

#### Южный регион

| Город | Население | Доля от РФ | DAU |
|-------|-----------|------------|-----|
| Ростов-на-Дону | ~1.1 млн | 0.8% | 340 000 |
| Краснодар | ~1.1 млн | 0.8% | 340 000 |
| **Итого** | **~2.3 млн** | **1.6%** | **680 000** |

#### Сводка по всем регионам

| Регион | Население | DAU | Доля от общего DAU |
|--------|-----------|-----|-------------------|
| Центральный | ~16.4 млн | 4 760 000 | 11.2% |
| Северо-Западный | ~5.6 млн | 1 615 000 | 3.8% |
| Уральский | ~4.9 млн | 1 445 000 | 3.4% |
| Сибирский | ~3.9 млн | 1 147 500 | 2.7% |
| Приволжский | ~2.5 млн | 722 500 | 1.7% |
| Южный | ~2.3 млн | 680 000 | 1.6% |

#### Сводка по всем рассмотренным городам для размещения ДЦ (по DAU)

Город | Регион | DAU | Доля от общего DAU | Приоритет |
------|---------|-----|-------------------|-----------|
Москва | Центральный | 3 825 000 | 9.0% | Критический |
Санкт-Петербург | Северо-Западный | 1 615 000 | 3.8% | Высокий |
Екатеринбург | Уральский | 467 500 | 1.1% | Высокий |
Новосибирск | Сибирский | 467 500 | 1.1% | Высокий |
Казань | Приволжский | 382 500 | 0.9% | Средний |
Нижний Новгород | Центральный | 340 000 | 0.8% | Средний |
Челябинск | Уральский | 340 000 | 0.8% | Средний |
Уфа | Уральский | 340 000 | 0.8% | Средний |
Красноярск | Сибирский | 340 000 | 0.8% | Средний |
Омск | Сибирский | 340 000 | 0.8% | Средний |
Самара | Приволжский | 340 000 | 0.8% | Средний |
Ростов-на-Дону | Южный | 340 000 | 0.8% | Средний |
Краснодар | Южный | 340 000 | 0.8% | Средний |
Воронеж | Центральный | 297 500 | 0.7% | Низкий |
Волгоград | Центральный | 297 500 | 0.7% | Низкий |
Пермь | Уральский | 297 500 | 0.7% | Низкий |

#### Сводная таблица RPS доменов по ДЦ

RPS домена в городе = (DAU города / общий DAU) * Общий RPS домена

| ДЦ | DAU | RPS ``wallet`` | RPS ``transaction`` | Сумма пред. RPS |
|--------|-----|------------|-----------------|-----------|
| Москва | 3 825 000 | 144 | 235 | 379 |
| Санкт-Петербург | 1 615 000 | 61 | 99 | 160 |
| Екатеринбург | 467 500 | 18 | 29 | 47 |
| Новосибирск | 467 500 | 18 | 29 | 47 |
| Казань | 382 500 | 14 | 23 | 37 |
| Ростов-на-Дону | 340 000 | 13 | 21 | 34 |

#### Таблица расстояний между городами (км)

| Город | Москва | Санкт-Петербург | Екатеринбург | Новосибирск | Казань | Ростов-на-Дону |
|-----------|--------|------------------|--------------|-------------|--------|----------------|
| Москва | - | 710 | 1 420 | 3 360 | 820 | 1 090 |
| Санкт-Петербург | 710 | - | 2 130 | 3 380 | 1 530 | 1 800 |
| Екатеринбург | 1 420 | 2 130 | - | 1 460 | 1 140 | 2 080 |
| Новосибирск | 3 360 | 3 380 | 1 460 | - | 2 350 | 3 540 |
| Казань | 820 | 1 530 | 1 140 | 2 350 | - | 1 530 |
| Ростов-на-Дону | 1 090 | 1 800 | 2 080 | 3 540 | 1 530 | - |

#### Расчет примерной задержки связи между ДЦ (мс)

По примеру [приложения A](#приложение-a).

**Формула:** Задержка = (Расстояние * 1.7) / 200 + 10 мс, где:
- 1.7 - коэффициент увеличения пути (оптоволокно не идет по прямой),
- 200 - скорость распространения сигнала в оптоволокне (км/мс) [[18]](#источники),
- 10 мс - запас на сетевое оборудование и маршрутизацию.

| Город | Москва | Санкт-Петербург | Екатеринбург | Новосибирск | Казань | Ростов-на-Дону |
|-----------|--------|------------------|--------------|-------------|--------|----------------|
| Москва | - | 11 [[0]](#источники) | 22 | 39 | 17 | 19 |
| Санкт-Петербург | 11 [[0]](#источники) | - | 28 | 39 | 23 | 25 |
| Екатеринбург | 22 | 28 | - | 22 | 20 | 28 |
| Новосибирск | 39 | 39 | 22 | - | 30 | 40 |
| Казань | 17 | 23 | 20 | 30 | - | 23 |
| Ростов-на-Дону | 19 | 25 | 28 | 40 | 23 | - |

### Схемы балансировки

> DNS - самый простой механизм балансировки, и балансировать таким образом можно любые системы, в которых доступ к сервису происходит по имени [[19]](#источники).

> Суть балансировки на базе Anycast: мы из разных географических участков анонсируем один и тот же префикс сети. Таким образом, каждый запрос клиента будет маршрутизироваться на ближайший к нему сервер, который будет его обрабатывать [[19]](#источники).

**Вывод:** глобальная балансировка нагрузки не требуется. Все пользователи могут быть направлены в единый московский ДЦ по следующим причинам:
- 95% трафика генерируется в пределах России,
- максимальная задержка до Москвы ([таблица связи между ДЦ](#расчет-примерной-задержки-связи-между-дц-мс)) не превышает 40 мс даже для Дальнего Востока.

### Локальная балансировка нагрузки

#### Схема балансировки нагрузки

![Схема балансировки нагрузки](/materials/highload_local_balance.png)

Локальная балансировка нагрузки состоит из нескольких уровней:
1. Клиентский. Инициирует HTTP/HTTPS запросы.
2. L7 Балансировщики
Используется 2 Nginx сервера
Функции: SSL Termination, маршрутизация по доменам
Распределяет на L4 кластеры по типам запросов
Схема резервирования: N+1 (1 рабочий + 1 резервный)
- SSL Termination вынесен на отдельные L7 серверы
3. L4 Virtual Server Clusters
Разделение по доменам с разными VIP:
Wallet: VIP 100.100.100.101 (2 сервера)
Transaction: VIP 100.100.100.102 (2 сервера)
API: VIP 100.100.100.103 (1 сервер)
Технология: Direct Routing
Каждый сервер анонсирует общий VIP
L4 балансировщики и application servers используют один VIP
Ответы идут напрямую от app servers к клиенту (пунктирная линия)
Высокая производительность - нет bottleneck на возврате трафика
Но Сервера должны быть в одной физической сети.
Однако БД лежат с ДЦ по разным availability-зонам (latency равна 1.5 мс)
N+1 резервирование
Схема резервирования: N+1 (2 рабочих + 1 резервный)
- Direct Routing исключает bottleneck на возврате трафика
- Ответы идут напрямую от application servers к клиентам
4. Application Servers
Разделение по доменам:
Wallet: 2 сервера
Transaction: 2 сервера
API: 1 сервер
Каждый сервер настраивает соответствующий VIP на loopback
5. Database Layer
Master DB - для операций записи (Transaction)
Replica DB - для операций чтения (Wallet, API)
2 реплики: Replica DB-1 и Replica DB-2

Расчет количества балансировщиков

Исходные данные:
- **Средний RPS:** 4205
- **Пиковый RPS:** 12662 (* 3 коэффициент)
- **Пиковый трафик:** 108.6 Мбит/с * 3 = 326 Мбит/с

### Ограничители производительности:

**1. SSL Termination:**
- 1 ядро CPU: ~3,000 RSA handshakes/sec
- Пиковый RPS: 12662 запросов/сек
- Требуется: 12,662 / 3,000 = 4.2 → **5 ядер**

**2. Пропускная способность сети:**
- Пиковый трафик: 326 Мбит/с
- 1x 10G порт: 9.5 Гбит/с полезной нагрузки
- Требуется: 326 Мбит/с / 9500 Мбит/с = **0.035 порта**

### Расчет серверов:

| Компонент | Расчет | Результат | Резервирование |
|-----------|--------|-----------|----------------|
| **L4 Virtual Server** | 12,662 RPS / 5,000 RPS = 2.53 | **3 сервера** | N+1 |
| **L7 Nginx** | 12,662 RPS / 1,500 RPS = 8.44 | **9 серверов** | N+1 |
| **Backend Services** | 12,662 RPS / 400 RPS = 31.65 | **33 сервера** | N+2 |

### Источники

0. [Экспертная оценка, опыт Александра Быкова :)](https://vk.com/inited)
1. [На-Связи.ru - Статистика Сбербанка на 2018 год](https://forum.na-svyazi.ru/?showtopic=2874293)
2. [Амурская правда - Статистика пользователей Сбербанк Онлайн](https://ampravda.ru/2019/09/21/91076.html)
3. [VK - Статистика месячной аудитории на 2023 год](https://vk.com/wall-22522055_2157676)
4. [Habr - 110 тысяч новых сессий в минуту: архитектура Сбербанк Онлайн](https://habr.com/ru/companies/sberbank/articles/728612/)
5. [Bankinform - Клиентская база Сбербанка в 2025 году](https://bankinform.ru/news/137349)
6. [SberBank Investor Relations - Финансовая отчетность за 7 месяцев 2025 года](https://www.sberbank.com/ru/investor-relations/groupresults/august11_publication_oftheras_in_7months)
7. [В каких странах есть офисы Сбербанка? - Рамблер/личные финансы](https://finance.rambler.ru/business/47064160-ot-kazahstana-i-ukrainy-do-kitaya-i-indii-v-kakih-stranah-est-ofisy-sberbanka/)
8. [Российские банки за рубежом: какие банки есть в Европе, США](https://brobank.ru/rossijskie-banki-za-rubezhom/)
9. [Как часто пользователи взаимодействуют с приложением?](https://sky.pro/wiki/money/top-10-prilozhenij-gde-mozhno-kopit-dengi-obzor-luchshih-reshenij/)
10. [Центробанк РФ - Заседание по финстабильности, 28 августа 2025](https://cbr.ru/press/event/?id=26885)  
11. [Интерфакс - Бизнес новости, 28 августа 2025](https://www.interfax.ru/business/1044499)
12. [Клерк.ру: Последние изменения для бухгалтеров, 10 июня 2025](https://www.klerk.ru/buh/news/650543/)
13. [ЦБ РФ: Аналитический обзор Системы быстрых платежей, 2025 год](https://cbr.ru/analytics/nps/sbp/2_2025/)
14. [ВТБ сообщает о семикратном росте международных переводов, октябрь 2024](https://finance.mail.ru/2024-10-16/vtb-zafiksiroval-semikratnyy-rost-transgranichnyh-perevodov-63231064/)
15. [Актуальные события в банковской сфере, 28 июля 2025 г.](https://www.banki.ru/news/lenta/?id=11016273)
16. [Finance.Mail.ru: Выдача потребительских кредитов в России в июле выросла на 13%](https://finance.mail.ru/article/vydacha-potrebitelskih-kreditov-v-rossii-v-iyule-vyrosla-na-13-67504477/)
17. [РБК Недвижимость: Новости рынка недвижимости](https://realty.rbc.ru/news/6791fd2e9a794700663e2948)
18. [Занимательный оптокабель](https://nag.ru/news/18705)
19. [Сравнительный анализ методов балансировки трафика. HighLoad++ Junior / Хабр](https://habr.com/ru/companies/oleg-bunin/articles/319262/)

### Приложения

### Приложение A

![Лекция 2](/materials/p1.png)

### Приложение B

![Карта России](/materials/map.png)

### Приложение C

![Уровень 3: Virtual Server via Direct Routing](/materials/local_balance.png)
